<?php

namespace Composer;

use Composer\Semver\VersionParser;






class InstalledVersions
{
  private static $installed = array(
    'root' =>
    array(
      'pretty_version' => 'dev-master',
      'version' => 'dev-master',
      'aliases' =>
      array(),
      'reference' => 'ecf6a7c2d21c3d75fe3aab960bfa00e0e508877f',
      'name' => 'katchy/katchy-free',
    ),
    'versions' =>
    array(
      'katchy/katchy-free' =>
      array(
        'pretty_version' => 'dev-master',
        'version' => 'dev-master',
        'aliases' =>
        array(),
        'reference' => 'ecf6a7c2d21c3d75fe3aab960bfa00e0e508877f',
      ),
      'jbroadway/urlify' =>
      array(
        'pretty_version' => '1.1.3-stable',
        'version' => '1.1.3.0',
        'aliases' =>
        array(),
        'reference' => '37fe4e7680a1c8cd68ac43a27dac7ef4be476300',
      ),
      'mobiledetect/mobiledetectlib' =>
      array(
        'pretty_version' => '2.8.34',
        'version' => '2.8.34.0',
        'aliases' =>
        array(),
        'reference' => '6f8113f57a508494ca36acbcfa2dc2d923c7ed5b',
      ),
      'phpmailer/phpmailer' =>
      array(
        'pretty_version' => 'v6.1.8',
        'version' => '6.1.8.0',
        'aliases' =>
        array(),
        'reference' => '917ab212fa00dc6eacbb26e8bc387ebe40993bc1',
      ),
      'tijsverkoyen/akismet' =>
      array(
        'pretty_version' => '1.1.1',
        'version' => '1.1.1.0',
        'aliases' =>
        array(),
        'reference' => '6f7987fe181fd0fddbc9832f2ddeaf088425c83f',
      ),
    ),
  );







  public static function getInstalledPackages()
  {
    return array_keys(self::$installed['versions']);
  }









  public static function isInstalled($packageName)
  {
    return isset(self::$installed['versions'][$packageName]);
  }














  public static function satisfies(VersionParser $parser, $packageName, $constraint)
  {
    $constraint = $parser->parseConstraints($constraint);
    $provided = $parser->parseConstraints(self::getVersionRanges($packageName));

    return $provided->matches($constraint);
  }










  public static function getVersionRanges($packageName)
  {
    if (!isset(self::$installed['versions'][$packageName])) {
      throw new \OutOfBoundsException('Package "' . $packageName . '" is not installed');
    }

    $ranges = array();
    if (isset(self::$installed['versions'][$packageName]['pretty_version'])) {
      $ranges[] = self::$installed['versions'][$packageName]['pretty_version'];
    }
    if (array_key_exists('aliases', self::$installed['versions'][$packageName])) {
      $ranges = array_merge($ranges, self::$installed['versions'][$packageName]['aliases']);
    }
    if (array_key_exists('replaced', self::$installed['versions'][$packageName])) {
      $ranges = array_merge($ranges, self::$installed['versions'][$packageName]['replaced']);
    }
    if (array_key_exists('provided', self::$installed['versions'][$packageName])) {
      $ranges = array_merge($ranges, self::$installed['versions'][$packageName]['provided']);
    }

    return implode(' || ', $ranges);
  }





  public static function getVersion($packageName)
  {
    if (!isset(self::$installed['versions'][$packageName])) {
      throw new \OutOfBoundsException('Package "' . $packageName . '" is not installed');
    }

    if (!isset(self::$installed['versions'][$packageName]['version'])) {
      return null;
    }

    return self::$installed['versions'][$packageName]['version'];
  }





  public static function getPrettyVersion($packageName)
  {
    if (!isset(self::$installed['versions'][$packageName])) {
      throw new \OutOfBoundsException('Package "' . $packageName . '" is not installed');
    }

    if (!isset(self::$installed['versions'][$packageName]['pretty_version'])) {
      return null;
    }

    return self::$installed['versions'][$packageName]['pretty_version'];
  }





  public static function getReference($packageName)
  {
    if (!isset(self::$installed['versions'][$packageName])) {
      throw new \OutOfBoundsException('Package "' . $packageName . '" is not installed');
    }

    if (!isset(self::$installed['versions'][$packageName]['reference'])) {
      return null;
    }

    return self::$installed['versions'][$packageName]['reference'];
  }





  public static function getRootPackage()
  {
    return self::$installed['root'];
  }







  public static function getRawData()
  {
    return self::$installed;
  }



















  public static function reload($data)
  {
    self::$installed = $data;
  }
}
